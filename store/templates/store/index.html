<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Our Products | Kafshy{% endblock %}</title>
    <meta name="description" content="Browse our collection of high-quality products">

    <!-- Preload critical resources -->
    {% load static %}
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style" crossorigin>
    <link rel="preload" href="{% static 'store/css/style.css' %}" as="style">

    <!-- CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{% static 'store/css/style.css' %}">
</head>

<body>
    <header class="main-header">
        <div class="header-container">
            <a href="{% url 'product_list' %}" class="logo-link" aria-label="Kafshy Home">
                <img src="{% static 'store/images/products/logo1.png' %}" alt="Kafshy Logo" class="logo" width="120" height="auto" loading="lazy">
            </a>

            <h1 class="store-title">Welcome to Our Store</h1>

            <div class="header-actions">
                {% if user.is_authenticated %}
                <a href="{% url 'account' %}" class="account-link" aria-label="My Account">
                    <i class="fas fa-user" aria-hidden="true"></i> <span class="account-text">My Account</span>
                </a>
                {% endif %}

                <a href="{% url 'cart' %}" class="cart-link" aria-label="Shopping Cart">
                    <i class="fas fa-shopping-cart" aria-hidden="true"></i>
                    <span class="cart-count">Cart ({{ cart_items.count|default:0 }})</span>
                </a>

                <button class="mobile-menu-toggle" aria-label="Toggle menu" aria-expanded="false">
                    <i class="fas fa-bars" aria-hidden="true"></i>
                </button>
            </div>
        </div>
    </header>

    <nav class="main-navigation" aria-label="Main navigation">
        <div class="nav-container">
            <ul class="nav-menu">
                <li class="has-submenu">
                    <button class="nav-link" aria-expanded="false" aria-haspopup="true">
                        Shop <i class="fas fa-chevron-down" aria-hidden="true"></i>
                    </button>
                    <div class="mega-menu" aria-hidden="true">
                        {% for category in categories %}
                        <div class="mega-menu-column">
                            <h3>{{ category.name }}</h3>
                            <ul>
                                {% for subcategory in category.subcategories.all %}
                                <li>
                                    <a href="{% url 'category_products' subcategory.id %}">
                                        {{ subcategory.name }}
                                    </a>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endfor %}
                    </div>
                </li>
                <li>
                    <a href="{% url 'about' %}" class="nav-link">About Us</a>
                </li>
                <li>
                    <a href="{% url 'contact' %}" class="nav-link">Contact</a>
                </li>
                {% if user.is_authenticated %}
                    {% if user.is_staff %}
                    <li>
                        <a href="{% url 'admin:index' %}" class="nav-link admin-link">Admin</a>
                    </li>
                    {% endif %}
                    <li>
                        <a href="{% url 'logout' %}" class="nav-link">Logout</a>
                    </li>
                {% else %}
                    <li>
                        <a href="{% url 'signin' %}" class="nav-link signin-btn">Sign In</a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <section class="hero-slider" aria-label="Product slideshow">
            <div class="slider-container">
                {% for slide in slides %}
                <div class="hero-slide"{% if not forloop.first %} aria-hidden="true"{% endif %}>
                    <img src="{{ slide.image.url }}" alt="{{ slide.alt_text }}" loading="lazy" class="slide-image" width="1200" height="400">
                    {% if slide.heading or slide.button_text %}
                    <div class="slide-content">
                        {% if slide.heading %}
                        <h2>{{ slide.heading }}</h2>
                        {% endif %}
                        {% if slide.subheading %}
                        <p>{{ slide.subheading }}</p>
                        {% endif %}
                        {% if slide.button_text %}
                        <a href="{{ slide.button_link }}" class="slide-button">
                            {{ slide.button_text }}
                        </a>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </section>

        <section class="product-section" aria-labelledby="featured-products-heading">
            <div class="section-header">
                <h2 id="featured-products-heading">Featured Products</h2>
                <div class="sort-options">
                    <label for="sort-by">Sort by:</label>
                    <select id="sort-by" class="sort-select" aria-label="Sort products">
                        <option value="popular">Most Popular</option>
                        <option value="newest">Newest Arrivals</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                    </select>
                </div>
            </div>

            <div class="product-grid">
                {% for product in products %}
                <article class="product-card">
                    <a href="{% url 'product_detail' product.id %}" class="product-link" aria-label="{{ product.name }}">
                        <div class="product-image-container">
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" loading="lazy" class="product-image" width="300" height="300">
                            {% if product.is_new %}
                            <span class="product-badge new" aria-label="New product">New</span>
                            {% endif %}
                            {% if product.discount_price %}
                            <span class="product-badge discount" aria-label="Discount {{ product.discount_percentage }}%">
                                -{{ product.discount_percentage }}%
                            </span>
                            {% endif %}
                        </div>

                        <div class="product-info">
                            <h3 class="product-title">{{ product.name }}</h3>
                            <p class="product-description">{{ product.short_description|truncatechars:100 }}</p>

                            <div class="product-price">
                                {% if product.discount_price %}
                                <span class="original-price" aria-hidden="true">${{ product.price }}</span>
                                <span class="discounted-price">${{ product.discount_price }}</span>
                                {% else %}
                                <span>${{ product.price }}</span>
                                {% endif %}
                            </div>

                            <div class="product-actions">
                                {% if user.is_authenticated %}
                                <form action="{% url 'add_to_cart' product.id %}" method="post" class="add-to-cart-form">
                                    {% csrf_token %}
                                    <input type="hidden" name="quantity" value="1">
                                    <button type="submit" class="add-to-cart-btn" aria-label="Add {{ product.name }} to cart">
                                        <i class="fas fa-shopping-cart" aria-hidden="true"></i> Add to Cart
                                    </button>
                                </form>
                                {% else %}
                                <a href="{% url 'signin' %}" class="login-to-buy">
                                    <i class="fas fa-sign-in-alt" aria-hidden="true"></i> Sign In to Buy
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </a>
                </article>
                {% empty %}
                <div class="no-products">
                    <p>No products available in this category.</p>
                    <a href="{% url 'product_list' %}" class="browse-all">Browse All Products</a>
                </div>
                {% endfor %}
            </div>

            {% if is_paginated %}
            <nav class="pagination" aria-label="Product pagination">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}" class="page-link" aria-label="Previous page">
                    <i class="fas fa-chevron-left" aria-hidden="true"></i> Previous
                </a>
                {% endif %}

                <span class="current-page">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                </span>

                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" class="page-link" aria-label="Next page">
                    Next <i class="fas fa-chevron-right" aria-hidden="true"></i>
                </a>
                {% endif %}
            </nav>
            {% endif %}
        </section>
    </main>

    <footer class="main-footer">
        <div class="footer-container">
            <div class="footer-section">
                <h4>Shop</h4>
                <ul>
                    {% for category in categories|slice:":5" %}
                    <li><a href="{% url 'category_products' category.id %}">{{ category.name }}</a></li>
                    {% endfor %}
                </ul>
            </div>

            <div class="footer-section">
                <h4>Customer Service</h4>
                <ul>
                    <li><a href="{% url 'contact' %}">Contact Us</a></li>
                    <li><a href="{% url 'faq' %}">FAQs</a></li>
                    <li><a href="{% url 'shipping' %}">Shipping & Returns</a></li>
                    <li><a href="{% url 'size_guide' %}">Size Guide</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4>About Kafshy</h4>
                <ul>
                    <li><a href="{% url 'about' %}">Our Story</a></li>
                    <li><a href="{% url 'sustainability' %}">Sustainability</a></li>
                    <li><a href="{% url 'careers' %}">Careers</a></li>
                </ul>
            </div>

            <div class="footer-section newsletter">
                <h4>Stay Connected</h4>
                <p>Subscribe for updates and promotions</p>
                <form class="newsletter-form">
                    <label for="newsletter-email" class="sr-only">Email address</label>
                    <input type="email" id="newsletter-email" placeholder="Your email address" required>
                    <button type="submit">Subscribe</button>
                </form>
                <div class="social-links">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f" aria-hidden="true"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram" aria-hidden="true"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
                    <a href="#" aria-label="Pinterest"><i class="fab fa-pinterest-p" aria-hidden="true"></i></a>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <div class="payment-methods" aria-label="Accepted payment methods">
                <i class="fab fa-cc-visa" aria-hidden="true" title="Visa"></i>
                <i class="fab fa-cc-mastercard" aria-hidden="true" title="Mastercard"></i>
                <i class="fab fa-cc-amex" aria-hidden="true" title="American Express"></i>
                <i class="fab fa-cc-paypal" aria-hidden="true" title="PayPal"></i>
            </div>
            <p>&copy; 2025 Kafshy. All Rights Reserved. | <a href="{% url 'privacy' %}">Privacy Policy</a> | <a
                    href="{% url 'terms' %}">Terms of Service</a></p>
        </div>
    </footer>

    <script src="{% static 'store/js/script.js' %}" defer></script>
</body>

</html>